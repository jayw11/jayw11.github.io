<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> gdp </title>
    <link rel="stylesheet" href="styles.css">
    <!-- <link rel="stylesheet" type="text/css" href="multiline.css"> -->
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
</head>
<body bgcolor="#FAFFF0">
    <center>
        <p style="font-size:30px;font-family:Tahoma;color:#082E54;font-weight: bold">
                World <span style="color: #FF9912;">GDP</span> & Mortality During COVID-19
        </p>
    </center>

     <center>
    <div class="chart-wrapper" id="gdp">
        <p style="font-size:18px;font-family:Tahoma;color:#082E54">
                 GDP and COVID-19 data is collected from ourworldindata.org. Similar to the midterm project, this scatter plot is color-coded by continent to have a better understanding about the case around the world. Mouseover event will bring a tooltip which shows the country name as well as highlight the corresponding continent. Annotations are given to continents.
        </p>
    </div>
     </center>

    <script>

    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 70, bottom: 80, left: 70},
        width = 800 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var svg = d3.select("#gdp")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
              
    d3.csv("https://raw.githubusercontent.com/jayw11/jayw11.github.io/master/covid19.csv", function(data) {

      var x = d3.scaleLog()
        .domain([900, 170000])
        .range([ 0, width ]);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
      svg.append("text")             
          .attr("transform",
                "translate(" + (width/2) + " ," + 
                               (height + margin.top + 20) + ")")
          .style("text-anchor", "middle")
          .text("GDP (Log)");
          
      var y = d3.scaleLog()
        .domain([0.1, 850])
        .range([height,0]);
      svg.append("g")
        .call(d3.axisLeft(y));
      svg.append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 0 - margin.left)
          .attr("x",0 - (height / 2))
          .attr("dy", "1em")
          .style("text-anchor", "middle")
          .text("Total Death Per Million (Log)");
          
      var color = d3.scaleOrdinal()
        .domain(["Asia", "Oceania", "Africa", "NorthAmerica", "Europe", "SouthAmerica" ])
        .range([ "#FFD700", "#4169E1", "#802A2A", "#7CFC00", "8A2BE2", "FF6347"])
        
      var tooltip = d3.select("body").append("tooltip")   
        .attr("class", "tooltip")               
        .style("opacity", 0);

      var mouseover = function(d){
        continents = d.continent
        d3.selectAll(".dot")
          .transition()
          .duration(100)
          // .style("fill", "grey")
          .attr("r", 3)

        d3.selectAll("." + continents)
          .transition()
          .duration(100)
          .style("fill", color(continents))
          .attr("r", 7)

        tooltip.transition()        
                .duration(200)      
                .style("opacity", .7);
        tooltip.html("Country: " + d.location)
            .style("left", (d3.event.pageX) + "px")        
            .style("top", (d3.event.pageY - 28) + "px");    
      }

      var mouseleave = function(d){
        d3.selectAll(".dot")
          .transition()
          .duration(100)
          // .style("fill", "grey")
          .attr("r", 5 )

        tooltip.transition()        
                .duration(500)      
                .style("opacity", 0); 
        }
      
      // Add dots
      svg.append('g')
        .selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", function (d) { return 0; } )
          .attr("cy", function (d) { return y(d.deaths_per_million); } )
          .attr("r", 5)
          .style("fill", function (d) { return color(d.continent) } )
          .transition()
          .duration(1500)
          .attr("class", function (d) { return "dot " + d.continent } )
          .attr("cx", function (d) { return x(d.gdp_per_capita); } )
          .attr("cy", function (d) { return y(d.deaths_per_million); } )
          .attr("r", 5);

    svg.selectAll("circle")
        .on("mouseover", mouseover)
        .on("mouseleave", mouseleave )

    // add annotation
    // svg
    //   .append("line")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x1", x(130) )
    //   .attr("x2", x(100) )
    //   .attr("y1", function (d) { return y(15); } )
    //   .attr("y2", function (d) { return y(50); } )
    //   .attr("stroke", "grey")
    //   .attr("stroke-dasharray", "4")
    //   .style("opacity", 1);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(130))
    //   .attr("y", function (d) { return y(10); } )
    //   .text("European countries tend to have")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(130))
    //   .attr("y", function (d) { return y(7); } )
    //   .text("higher gdp & mortality rate.")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);

    // svg
    //   .append("line")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x1", x(-100) )
    //   .attr("x2", x(-50) )
    //   .attr("y1", function (d) { return y(0.4); } )
    //   .attr("y2", function (d) { return y(1); } )
    //   .attr("stroke", "grey")
    //   .attr("stroke-dasharray", "4")
    //   .style("opacity", 1);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(-400))
    //   .attr("y", function (d) { return y(0.3); } )
    //   .text("Asian & African countries have average")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(-400))
    //   .attr("y", function (d) { return y(0.2); } )
    //   .text("gdp but varies on mortality rate.")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);


    // svg
    //   .append("line")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x1", x(-230) )
    //   .attr("x2", x(-200) )
    //   .attr("y1", function (d) { return y(8); } )
    //   .attr("y2", function (d) { return y(20); } )
    //   .attr("stroke", "grey")
    //   .attr("stroke-dasharray", "4")
    //   .style("opacity", 1);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(-400))
    //   .attr("y", function (d) { return y(6); } )
    //   .text("American countries have low")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);
    // svg
    //   .append("text")
    //   .style("opacity", 0)
    //   .transition()
    //   .duration(1500)
    //   .attr("x", x(-400))
    //   .attr("y", function (d) { return y(4); } )
    //   .text("gdp and high mortality rate.")
    //   .style("font-size", "15px")
    //   .style("font-family", "Trebuchet MS")
    //   .attr("width",1)
    //   .style("color", "#082E54")
    //   .style("opacity", 1.0);
    })

    </script>

    <center>
        <p></p>
        <button class="button2" style="vertical-align:left" onclick="location.href='mobility.html'"><span>Previous </span></button>
        <font size="3" face="Arial Black">
                <a class="scene1" href="mobility.html">Mobility</a>
                |
                <a class="scene2" href="gdp.html">GDP</a>
                |
                <a class="scene2" href="page2-3.html">Scene 2-3</a>
            </font>
       <button class="button2" style="vertical-align:right" onclick="location.href='gdp.html'"><span>Next </span></button>
    </center>
</body>
</html>